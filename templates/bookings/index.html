{% extends "bookings/base.html" %}
{% load static %}

{% block content %}

<div class="container" style="padding: 30px;">

    <!-- üîç Search & Filter Form -->
    <form method="get" class="filter-form" style="display:flex; gap:10px; margin-bottom:30px;">
        <input
            type="text"
            name="search"
            placeholder="Search movies..."
            value="{{ request.GET.search|default:'' }}"
            style="padding:8px; flex:1;"
        >

        <select name="genre" style="padding:8px;">
            <option value="">All Genres</option>
            {% for movie in movies %}
                {% if movie.genre %}
                    <option value="{{ movie.genre }}"
                        {% if request.GET.genre == movie.genre %}selected{% endif %}>
                        {{ movie.genre }}
                    </option>
                {% endif %}
            {% endfor %}
        </select>

        <button type="submit" style="padding:8px 16px;">Filter</button>
    </form>

    <!-- üé¨ Movie Cards -->
    <div class="movie-grid"
         style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:25px;">

        {% if movies %}
            {% for movie in movies %}
                <div class="movie-card"
                     style="background:#fff; border-radius:12px; padding:15px; text-align:center;
                            box-shadow:0 6px 15px rgba(0,0,0,0.1);">

                    <!-- Poster (SAFE) -->
                    {% if movie.poster %}
                        <img src="{{ movie.poster.url }}"
                             alt="{{ movie.title }}"
                             style="width:100%; height:300px; object-fit:cover; border-radius:10px;">
                    {% else %}
                        <img src="https://via.placeholder.com/300x450?text=No+Poster"
                             alt="No Poster"
                             style="width:100%; height:300px; object-fit:cover; border-radius:10px;">
                    {% endif %}

                    <!-- Movie Info -->
                    <h3 style="margin:12px 0 5px;">{{ movie.title|default:"Untitled Movie" }}</h3>

                    {% if movie.genre %}
                        <p style="color:#666;">{{ movie.genre }}</p>
                    {% endif %}

                    {% if movie.duration %}
                        <p>‚è± {{ movie.duration }}</p>
                    {% endif %}

                    <!-- Book Button (SAFE LINK) -->
                    <a href="{% url 'movie_detail' movie.id %}"
                       style="display:inline-block; margin-top:10px; padding:8px 16px;
                              background:#e50914; color:white; text-decoration:none;
                              border-radius:6px; font-weight:bold;">
                        Book Now
                    </a>

                </div>
            {% endfor %}
        {% else %}
            <p style="grid-column:1/-1; text-align:center;">
                No movies available.
            </p>
        {% endif %}

    </div>

</div>

{% endblock %}
